<%- model_class = @goal.class -%>
<script>
$(function() { 
	$('ul.nav-tabs').children().removeClass('active');
	$('div.tab-content').children().removeClass('active').removeClass('in');
	<% if @tab %>
		$('<%="#"+@tab+"-tab-link" %>').addClass('active');
		$('<%="#"+@tab+"-tab" %>').addClass('in active');
	<% else %>
		$('#goal-description-tab-link').addClass('active');
		$('#goal-description-tab').addClass('in active');
	<% end %>
});
</script>
<%= render 'achiever/achiever_profile', :achiever => @goal.achiever %>
<div class="span8">
	<%= render 'goals/header_div', :goal => @goal %>
	<ul id="goalTabs" class="nav nav-tabs">
		<li id="goal-description-tab-link" class="active"><a href="#goal-description-tab" data-toggle="tab"><%= t "description"%></a></li>
	    <li id="goal-journey-tab-link"><a href="#goal-journey-tab" data-toggle="tab"><%= t "journey"%></a></li>
	    <li id="goal-comments-tab-link"><a href="#goal-comments-tab" data-toggle="tab"><%= t "comments"%></a></li>
	    <li id="goal-donations-tab-link"><a href="#goal-donations-tab" data-toggle="tab"><%= t "donations"%></a></li>
	 </ul>
	 <div id="goalTabsContent" class="tab-content">
		 <div class="tab-pane fade in active" id="goal-description-tab">
			<%= render 'description_tab', :goal => @goal %>
		 </div>
		 <div class="tab-pane fade" id="goal-journey-tab">	
				<% if current_user_is_achiever?(@goal.achiever) && @goal.goalStage != GoalStage::DONE%>
				<%= form_for @goal_feedback,  :url => '/'+@goal.achiever.username+'/goals/add_feedback/'+@goal.id.to_s+'?tab=goal-journey' do |f| %>    
				<%= render 'layouts/model_error_messages', :target => @goal_feedback %>
				Change to: <%= collection_select(:goal_feedback, :goal_stage_id, GoalStage.possible_goal_stage_updates, :id, :name) %>
				  <div class="field">
				    <%= f.label :feedback %><br />
				    <%= f.text_area :message, :rows => 10 %>
				    <%= f.submit nil, :class => 'btn btn-primary', :value => 'Send', :disable_with => 'Saving...' %>
				  </div>
				<% end %>
				<% end %>
				<div id="feedbacks_div">
					<% feedbacks = @goal.find_feedback() %>	
					    <% feedbacks.each do |feedback| %>
					<%= feedback.message%>
					<span class="small_i_font">(<%= feedback.created_at %>)</span>
					<hr style="color: #717171; height: 1px;">
					<% end %>
			    </div>
		 </div>
		<div class="tab-pane fade" id="goal-comments-tab">
			<fb:comments href="<%= current_url %>"></fb:comments>
		 </div>
		 <div class="tab-pane fade" id="goal-donations-tab">
			<%= render 'donation_tab'%>
		 </div>
	</div>
	
    <div class="fb-like" data-href="<%= current_url %>" data-send="true" data-width="450"></div>
	<div class="form-actions">
		<%= link_to t('back'), '/'+@goal.achiever.username, :class => 'btn' %>
	</div>
</div>